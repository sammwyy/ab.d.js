{"version":3,"file":"ab.d.js","sources":["../src/index.ts"],"sourcesContent":["// Utils\r\nexport function makeID(length: number) {\r\n  let result = \"\";\r\n  const characters =\r\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n  const charactersLength = characters.length;\r\n  let counter = 0;\r\n  while (counter < length) {\r\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\r\n    counter += 1;\r\n  }\r\n  return result;\r\n}\r\n\r\n// Tests\r\nexport type TestType = \"dom\" | \"scripts-interceptor\";\r\nexport type TestFunc = () => boolean | Promise<boolean> | (() => boolean);\r\n\r\n// DOM\r\nexport const TestScriptInterceptor = async () => {\r\n  const files = [\"ads.js\", \"ad_top.js\", \"ads\", \"ad?type=banner\"];\r\n  const originalRes = await fetch(`/${makeID(32)}/${makeID(6)}.js`);\r\n\r\n  for (const file of files) {\r\n    const fullURL = `/${makeID(32)}/${file}`;\r\n    const res = await fetch(fullURL, {\r\n      method: \"GET\",\r\n    }).catch(() => ({ ok: false, status: 500 }));\r\n\r\n    if (res.status != originalRes.status) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport const TestDom = async () => {\r\n  const runTest = (name: string) => {\r\n    const rid = makeID(8);\r\n    const el = document.createElement(\"div\");\r\n\r\n    el.classList.add(name);\r\n    el.style.display = \"block\";\r\n    el.style.width = \"5px\";\r\n    el.style.opacity = \"0.02\";\r\n    el.style.transform = \"translate(-999999px)\";\r\n    el.style.position = \"absolute\";\r\n    el.style.color = \"transparent\";\r\n    el.innerHTML = `<div id=\"${rid}\"></div>`;\r\n\r\n    document.body.appendChild(el);\r\n\r\n    return new Promise((resolve) => {\r\n      setTimeout(() => {\r\n        const result = document.getElementById(rid);\r\n        if (!result) return resolve(true);\r\n\r\n        const isInDOM = result.parentElement?.parentElement == document.body;\r\n        const hasStyles =\r\n          el.style.display == \"block\" &&\r\n          el.style.width == \"5px\" &&\r\n          el.style.opacity == \"0.02\" &&\r\n          el.style.transform == \"translate(-999999px)\";\r\n\r\n        if (isInDOM && hasStyles) {\r\n          resolve(false);\r\n          result.remove();\r\n          el.remove();\r\n        } else {\r\n          resolve(true);\r\n        }\r\n      }, 1);\r\n    });\r\n  };\r\n\r\n  const names = [\r\n    \"adsbox\",\r\n    \"ads\",\r\n    \"ad\",\r\n    \"main-ad-300x600-banner\",\r\n    \"ad-banner\",\r\n    \"-ad-right\",\r\n    \"-ad-sidebar\",\r\n  ];\r\n\r\n  for (const name of names) {\r\n    const result = await runTest(name);\r\n    if (result) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\n// Main class\r\nconst withLog = async (name: string, fun: TestFunc) => {\r\n  const functionResult = await fun();\r\n  const result =\r\n    typeof functionResult == \"function\" ? functionResult() : functionResult;\r\n\r\n  if (result) {\r\n    console.log(\"[AB.d] ❌ Triggered \" + name + \" test.\");\r\n  } else {\r\n    console.log(\"[AB.d] ✅ Pass \" + name + \" test.\");\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\nexport type ABDSettings = {\r\n  dom?: boolean;\r\n  scripts?: boolean;\r\n};\r\n\r\nexport default class ABD {\r\n  async runTestDom(): Promise<boolean> {\r\n    return await withLog(\"DOM\", TestDom);\r\n  }\r\n\r\n  async runTestScriptInterceptor(): Promise<boolean> {\r\n    return await withLog(\"Script-Interceptor\", TestScriptInterceptor);\r\n  }\r\n\r\n  async hasAdBlock({\r\n    dom,\r\n    scripts,\r\n  }: ABDSettings = {}): Promise<TestType | null> {\r\n    if (dom) {\r\n      const result = await this.runTestDom();\r\n      if (result) return \"dom\";\r\n    }\r\n\r\n    if (scripts) {\r\n      const result = await this.runTestScriptInterceptor();\r\n      if (result) return \"scripts-interceptor\";\r\n    }\r\n\r\n    return null;\r\n  }\r\n}\r\n\r\ndeclare global {\r\n  interface Window {\r\n    ABD: ABD;\r\n  }\r\n}\r\n\r\nwindow.ABD = new ABD();\r\n"],"names":["makeID","length","result","characters","charactersLength","counter","charAt","Math","floor","random","TestScriptInterceptor","files","originalRes","fetch","file","fullURL","res","method","catch","ok","status","TestDom","runTest","name","rid","el","document","createElement","classList","add","style","display","width","opacity","transform","position","color","innerHTML","body","appendChild","Promise","resolve","setTimeout","getElementById","isInDOM","parentElement","hasStyles","remove","names","withLog","fun","functionResult","console","log","ABD","runTestDom","runTestScriptInterceptor","hasAdBlock","dom","scripts","window"],"mappings":"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"}